<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Road for Kids</title>
  <meta name="description" content="Cute VR Road for Kids - A-Frame">
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>

  <a-scene id="scene">
    <!-- Ground (Road) -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="500" height="500" color="#8B8B8B"></a-plane>

   <!-- 1台目の赤い車 -->
<a-entity 
  id="car1"
  position="-0.7 0 -81"  
  scale="2 2 2"         
  rotation="0 0 0"    
  gltf-model="car.glb"
  car-movement="speed: 0.8">
</a-entity>

<!-- 2台目の黒い車 -->
<a-entity 
  id="car2"
  position="-86 0 -38.803"  
  scale="2 2 2"         
  rotation="0 89.919 0"    
  gltf-model="blackcar.glb"
  car-movement="speed: 0.8">
</a-entity>

<!-- 3台目の青い車 -->
<a-entity 
  id="car3"
  position="-52.154 0 -89"  
  scale="2 2 2"         
  rotation="0 0 0"    
  gltf-model="bluecar.glb"
  car-movement="speed: 0.8">
</a-entity>


    

    <!-- 6台目の黒い車 -->
    <a-entity 
      id="car5"
      position="-82.813 0 -194.6"  
      scale="2 2 2"         
      rotation="0 91 0"    
      gltf-model="blackcar1.glb"
      car-movement="speed: 0.8">
    </a-entity>

    <!-- 4台目の赤い車 -->
    <a-entity 
      id="car6"
      position="-43 0 -179"  
      scale="2 2 2"         
      rotation="0 0 0"    
      gltf-model="car1.glb"
      car-movement="speed: 0.8">
    </a-entity>

    

    

    <!-- 家 -->
    <a-entity position="-15.461 2.878 -30" scale="0.4 0.4 0.4" gltf-model="orangehouse.glb"></a-entity>
    <a-entity position="-15.358 3 -17" scale="0.4 0.4 0.4" gltf-model="yellowhouse.glb"></a-entity>

    <a-entity position="-9.755 3 -10" scale="0.4 0.4 0.4" rotation="0 86.966 0" gltf-model="purplehouse.glb"></a-entity>
    <a-entity position="-9.442 3 13" scale="0.4 0.4 0.4" rotation="0 86.994 0" gltf-model="bluehouse.glb"></a-entity>
    
    <a-entity position="8 3 -43.034" rotation="0 -122.9 0" scale="0.4 0.4 0.4" gltf-model="orangehouse1.glb"></a-entity>
    <a-entity position="16.706 3 -43.860" rotation="0 178.625 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse1.glb"></a-entity>
    <a-entity position="-9.658 3 -51.321" rotation="0 87.323 0" scale="0.4 0.4 0.4" gltf-model="purplehouse1.glb"></a-entity>
    <a-entity position="9.819 3 17.167" scale="0.4 0.4 0.4" rotation="0 -90.871 0" gltf-model="bluehouse1.glb"></a-entity>
    <a-entity position="15.31 3 58.771" rotation="0 177.88 0" scale="0.4 0.4 0.4" gltf-model="orangehouse2.glb"></a-entity>
    <a-entity position="-37.544 3 -6.197" rotation="0 -28.111 0" scale="0.4 0.4 0.4" gltf-model="purplehouse3.glb"></a-entity>
    <a-entity position="-46.783 3 -49.439" scale="0.4 0.4 0.4" rotation="0 -0.93 0" gltf-model="bluehouse2.glb"></a-entity>v
    <a-entity position="-40.567 3 -55.825" rotation="0 -90.355 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse2.glb"></a-entity>
    <a-entity position="-9.404 3 -74.223" scale="0.4 0.4 0.4" rotation="0 86.891 0" gltf-model="bluehouse3.glb"></a-entity>
    <a-entity position="-64.190 3 -50.072" rotation="0 -1.121 0" scale="0.4 0.4 0.4" gltf-model="purplehouse2.glb"></a-entity>
     <a-entity position="-65.445 3 -49.282" rotation="0 -0.428 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse3.glb"></a-entity>
    <a-entity position="-102.16 3 -23.281" rotation="0 90.74 0" scale="0.4 0.4 0.4" gltf-model="orangehouse3.glb"></a-entity>
    <a-entity position="-80.895 3 -28.964" scale="0.4 0.4 0.4" rotation="0 175.565 0" gltf-model="bluehouse4.glb"></a-entity>
     <a-entity position="-76.981 3 -46.44" rotation="0 -89.843 0" scale="0.4 0.4 0.4" gltf-model="purplehouse4.glb"></a-entity>
     <a-entity position="-65.379 3 -67.144" rotation="0 -0.428 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse4.glb"></a-entity>
    <a-entity position="-34.020 3 -54.999" rotation="0 178.592 0" scale="0.4 0.4 0.4" gltf-model="orangehouse4.glb"></a-entity>
     <a-entity position="-59.144 3 -90.432" scale="0.4 0.4 0.4" rotation="0 86.372 0" gltf-model="bluehouse5.glb"></a-entity>
     <a-entity position="-39.612 3 -100.17" rotation="0 -91.116 0" scale="0.4 0.4 0.4" gltf-model="purplehouse5.glb"></a-entity>
     <a-entity position="-31.485 3 -134.47" rotation="0 178.102 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse5.glb"></a-entity>
    <a-entity position="-65.739 3 -144.57" rotation="0 -0.823 0" scale="0.4 0.4 0.4" gltf-model="orangehouse5.glb"></a-entity>
    <a-entity position="-57.125 3 -139.76" scale="0.4 0.4 0.4" rotation="0 86.372 0" gltf-model="bluehouse6.glb"></a-entity>
     <a-entity position="-40.172 3 -147.03" rotation="0 -91.116 0" scale="0.4 0.4 0.4" gltf-model="purplehouse6.glb"></a-entity>
     <a-entity position="-29.683 3 -170.88" rotation="0 178.102 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse6.glb"></a-entity>
    <a-entity position="-67.388 3 -194.90" rotation="0 -0.823 0" scale="0.4 0.4 0.4" gltf-model="orangehouse6.glb"></a-entity>
    <a-entity position="8.932 3 -73.456" scale="0.4 0.4 0.4" rotation="0 179.507 0" gltf-model="bluehouse7.glb"></a-entity>
     <a-entity position="-7.481 3 -50.558" rotation="0 178.867 0" scale="0.4 0.4 0.4" gltf-model="purplehouse7.glb"></a-entity>
    
    <a-entity position="-48 0 -248" rotation="0 0 0" scale="4 3 3" gltf-model="school.glb"></a-entity>
    
    
    <!-- 空 -->
    <a-sky color="#87CEEB"></a-sky>

    
    <a-entity id="txt" position="0 2 -3" text="value: ; color: black;"></a-entity>


    <!-- カメラとコントローラー -->
    <a-entity id="cameraRig" position="3 1.6 0">
      <a-entity camera position="0 0 0" look-controls></a-entity>

      <!-- 左手コントローラー -->
      <a-entity id="ctlL" oculus-touch-controls="hand: left"></a-entity>

      <!-- 右手コントローラー -->
      <a-entity id="ctlR" oculus-touch-controls="hand: right"></a-entity>
    </a-entity>
  </a-scene>

  <script>
  const txt = document.getElementById("txt");
  const cameraRig = document.getElementById("cameraRig");
  const ctlL = document.getElementById("ctlL");
  const ctlR = document.getElementById("ctlR");
  const car = document.getElementById("car1");

  // 左スティックの動きの表示
  ctlL.addEventListener("thumbstickmoved", function (event) {
    txt.setAttribute(
      "text",
      "value: L Stick  x:" +
        event.detail.x.toFixed(2) +
        ", y:" +
        event.detail.y.toFixed(2) +
        "; color: black;"
    );
  });

  // 右スティックの動きの表示 + カメラリグ移動
  ctlR.addEventListener("thumbstickmoved", function (event) {
    txt.setAttribute(
      "text",
      "value: R Stick  x:" +
        event.detail.x.toFixed(2) +
        ", y:" +
        event.detail.y.toFixed(2) +
        "; color: black;"
    );

    const moveSpeed = 0.5; // 移動速度
    const rotationSpeed = 0.1; // 回転速度

    // カメラリグの移動処理
    if (event.detail.y !== 0 || event.detail.x !== 0) {
      // カメラリグの現在の方向を取得
      const direction = new THREE.Vector3();
      cameraRig.object3D.getWorldDirection(direction);
      direction.y = 0; // 水平方向のみの移動
      direction.normalize();

      // 前後移動
      if (event.detail.y !== 0) {
        const moveVector = direction.clone().multiplyScalar(event.detail.y * moveSpeed);
        cameraRig.object3D.position.add(moveVector);
      }

      // 左右回転
      if (event.detail.x !== 0) {
        const rotation = cameraRig.object3D.rotation;
        rotation.y -= event.detail.x * rotationSpeed;
        cameraRig.object3D.rotation.set(rotation.x, rotation.y, rotation.z);
      }
    }
  });

    // 車のアニメーション
AFRAME.registerComponent("car-movement", {
  schema: {
    speed: { type: "number", default: 0.8 }, // 移動速度
    triggerDistance: { type: "number", default: 50 } // 移動開始距離
  },

  init: function () {
    this.cameraRig = document.getElementById("cameraRig"); // カメラリグを取得
    this.carPosition = this.el.object3D.position; // 車の位置を取得
    this.isMoving = false; // 車が移動中かどうか
  },

  tick: function () {
    const moveSpeed = this.data.speed;

    // カメラリグの位置を取得
    if (this.cameraRig) {
      const cameraRigPosition = this.cameraRig.object3D.position;
      const distance = this.carPosition.distanceTo(cameraRigPosition); // カメラとの距離

      // 距離がtriggerDistance以下の場合に表示＆移動開始
      if (distance <= this.data.triggerDistance) {
        this.el.setAttribute("visible", true);

        if (!this.isMoving) {
          this.isMoving = true; // 移動フラグをオン
        }
      }

      // 移動フラグがオンの場合に前進
      if (this.isMoving) {
        // X方向に移動する場合
        if (this.el.id === "car2" || this.el.id === "car5") {
          this.carPosition.x += moveSpeed; // 黒い車は+X方向に進む
        } else {
          this.carPosition.z += moveSpeed; // 赤・青い車は+Z方向に進む
        }
      }
    } else {
      console.error("cameraRigが見つかりません");
    }
  }
});


// 車に移動コンポーネントを追加
document.addEventListener("DOMContentLoaded", function () {
  const redCar = document.getElementById("car1"); // 赤い車
  const blueCar = document.getElementById("car3"); // 青い車
  const blackCar = document.getElementById("car2"); // 黒い車
  const redCar1 = document.getElementById("car6"); // 赤い車1
  const blackCar1 = document.getElementById("car5"); // 黒い車1

  // 赤い車: 一定距離に近づいたら動く設定（Z方向）
  redCar.setAttribute("car-movement", "speed: 0.8; triggerDistance: 80");

  // 青い車: 一定距離に近づいたら動く設定（Z方向）
  blueCar.setAttribute("car-movement", "speed: 0.8; triggerDistance: 50");

  // 黒い車: 一定距離に近づいたら+X方向に動く設定
  blackCar.setAttribute("car-movement", "speed: 0.8; triggerDistance: 70");

  // 赤い車1: 一定距離に近づいたら+Z方向に動く設定
  redCar1.setAttribute("car-movement", "speed: 0.8; triggerDistance: 100");

  // 黒い車1: 一定距離に近づいたら+X方向に動く設定
  blackCar1.setAttribute("car-movement", "speed: 0.8; triggerDistance: 40");
});



</script>




</body>
</html>
