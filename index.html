<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Road for Kids</title>
  <meta name="description" content="Cute VR Road for Kids - A-Frame">
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <div id="start-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); color: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <button style="padding: 20px; font-size: 24px;">Start VR</button>
  </div>

  <a-scene id="scene">
    <!-- Ground (Road) -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="500" height="500" color="#8B8B8B"></a-plane>

    <!-- 車 -->
    <a-entity 
      id="car"
      position="0.035 0 -20.443"  
      scale="1 1 1"         
      rotation="0 0 0"    
      gltf-model="car.glb">
      <!-- クラクションの音 -->
      <a-sound src="car.mp3" autoplay="false" position="0 0 0"></a-sound>
    </a-entity>

    <!-- 家 -->
    <a-entity position="-15.461 2.878 -30" scale="0.4 0.4 0.4" gltf-model="orangehouse.glb"></a-entity>
    <a-entity position="-15.358 3 -17" scale="0.4 0.4 0.4" gltf-model="yellowhouse.glb"></a-entity>
    
    <!-- 横断歩道 (white stripes) -->
    <a-entity position="-15.461 0.01 -30" scale="1 0.01 3" color="#FFFFFF"></a-entity> <!-- 1本目 -->
    <a-entity position="-15.461 0.01 -27" scale="1 0.01 3" color="#FFFFFF"></a-entity> <!-- 2本目 -->
    <a-entity position="-15.461 0.01 -24" scale="1 0.01 3" color="#FFFFFF"></a-entity> <!-- 3本目 -->
    <a-entity position="-15.461 0.01 -21" scale="1 0.01 3" color="#FFFFFF"></a-entity> <!-- 4本目 -->
    <a-entity position="-15.461 0.01 -18" scale="1 0.01 3" color="#FFFFFF"></a-entity> <!-- 5本目 -->

    <a-entity position="-9.755 3 -10" scale="0.4 0.4 0.4" rotation="0 86.966 0" gltf-model="purplehouse.glb"></a-entity>
    <a-entity position="-9.442 3 13" scale="0.4 0.4 0.4" rotation="0 86.994 0" gltf-model="bluehouse.glb"></a-entity>
    
    <a-entity position="8 3 -43.034" rotation="0 -122.9 0" scale="0.4 0.4 0.4" gltf-model="orangehouse1.glb"></a-entity>
    <a-entity position="16.706 3 -43.860" rotation="0 178.625 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse1.glb"></a-entity>
    <a-entity position="-9.658 3 -51.321" rotation="0 87.323 0" scale="0.4 0.4 0.4" gltf-model="purplehouse1.glb"></a-entity>
    <a-entity position="9.819 3 17.167" scale="0.4 0.4 0.4" rotation="0 -90.871 0" gltf-model="bluehouse1.glb"></a-entity>
    <a-entity position="15.31 3 58.771" rotation="0 177.88 0" scale="0.4 0.4 0.4" gltf-model="orangehouse2.glb"></a-entity>
    <a-entity position="-37.544 3 -6.197" rotation="0 -28.111 0" scale="0.4 0.4 0.4" gltf-model="purplehouse3.glb"></a-entity>
    <a-entity position="-46.783 3 -49.439" scale="0.4 0.4 0.4" rotation="0 -0.93 0" gltf-model="bluehouse2.glb"></a-entity>v
    <a-entity position="-40.567 3 -55.825" rotation="0 -90.355 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse2.glb"></a-entity>
    <a-entity position="-9.404 3 -74.223" scale="0.4 0.4 0.4" rotation="0 86.891 0" gltf-model="bluehouse3.glb"></a-entity>
    <a-entity position="-64.190 3 -50.072" rotation="0 -1.121 0" scale="0.4 0.4 0.4" gltf-model="purplehouse2.glb"></a-entity>
     <a-entity position="-65.445 3 -49.282" rotation="0 -0.428 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse3.glb"></a-entity>
    <a-entity position="-102.16 3 -23.281" rotation="0 90.74 0" scale="0.4 0.4 0.4" gltf-model="orangehouse3.glb"></a-entity>
    <a-entity position="-92.711 3 -28.964" scale="0.4 0.4 0.4" rotation="0 175.565 0" gltf-model="bluehouse4.glb"></a-entity>
     <a-entity position="-107.17 3 -50.278" rotation="0 -1.121 0" scale="0.4 0.4 0.4" gltf-model="purplehouse4.glb"></a-entity>
     <a-entity position="-65.379 3 -67.144" rotation="0 -0.428 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse4.glb"></a-entity>
    <a-entity position="-34.020 3 -54.999" rotation="0 178.592 0" scale="0.4 0.4 0.4" gltf-model="orangehouse4.glb"></a-entity>
     <a-entity position="-59.144 3 -90.432" scale="0.4 0.4 0.4" rotation="0 86.372 0" gltf-model="bluehouse5.glb"></a-entity>
     <a-entity position="-39.612 3 -100.17" rotation="0 -91.116 0" scale="0.4 0.4 0.4" gltf-model="purplehouse5.glb"></a-entity>
     <a-entity position="-31.485 3 -134.47" rotation="0 178.102 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse5.glb"></a-entity>
    <a-entity position="-65.739 3 -144.57" rotation="0 -0.823 0" scale="0.4 0.4 0.4" gltf-model="orangehouse5.glb"></a-entity>
    <a-entity position="-57.125 3 -139.76" scale="0.4 0.4 0.4" rotation="0 86.372 0" gltf-model="bluehouse6.glb"></a-entity>
     <a-entity position="-40.172 3 -147.03" rotation="0 -91.116 0" scale="0.4 0.4 0.4" gltf-model="purplehouse6.glb"></a-entity>
     <a-entity position="-29.683 3 -170.88" rotation="0 178.102 0" scale="0.4 0.4 0.4" gltf-model="yellowhouse6.glb"></a-entity>
    <a-entity position="-67.388 3 -194.90" rotation="0 -0.823 0" scale="0.4 0.4 0.4" gltf-model="orangehouse6.glb"></a-entity>
    <a-entity position="8.932 3 -73.456" scale="0.4 0.4 0.4" rotation="0 179.507 0" gltf-model="bluehouse7.glb"></a-entity>
     <a-entity position="-7.481 3 -50.558" rotation="0 178.867 0" scale="0.4 0.4 0.4" gltf-model="purplehouse7.glb"></a-entity>
    
    <a-entity position="-48 0 -248" rotation="0 0 0" scale="4 3 3" gltf-model="school.glb"></a-entity>
    
    
    <!-- 空 -->
    <a-sky color="#87CEEB"></a-sky>

    <!-- 表示用テキスト -->
    <a-entity id="txt" position="0 2 -3" text="value: Waiting for input; color: black;"></a-entity>

    <!-- カメラとコントローラー -->
    <a-entity id="cameraRig" position="3 1.6 0">
      <a-entity camera position="0 0 0" look-controls></a-entity>

      <!-- 左手コントローラー -->
      <a-entity id="ctlL" oculus-touch-controls="hand: left"></a-entity>

      <!-- 右手コントローラー -->
      <a-entity id="ctlR" oculus-touch-controls="hand: right"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    const txt = document.getElementById("txt");
    const cameraRig = document.getElementById("cameraRig");
    const ctlL = document.getElementById("ctlL");
    const ctlR = document.getElementById("ctlR");
    const car = document.getElementById("car");

    // 初回クリックでスタート
    document.getElementById("start-overlay").addEventListener("click", function () {
      this.style.display = "none";
    });

    // 左スティックの動きの表示
    ctlL.addEventListener("thumbstickmoved", function (event) {
      txt.setAttribute(
        "text",
        "value: L Stick  x:" +
          event.detail.x.toFixed(2) +
          ", y:" +
          event.detail.y.toFixed(2) +
          "; color: black;"
      );
    });

    // 右スティックの動きの表示 + カメラリグ移動
    ctlR.addEventListener("thumbstickmoved", function (event) {
      txt.setAttribute(
        "text",
        "value: R Stick  x:" +
          event.detail.x.toFixed(2) +
          ", y:" +
          event.detail.y.toFixed(2) +
          "; color: black;"
      );

      const moveSpeed = 0.1; // 移動速度
      const rotationSpeed = 0.05; // 回転速度

      // カメラリグの移動処理
      if (event.detail.y !== 0 || event.detail.x !== 0) {
        // カメラリグの現在の方向を取得
        const direction = new THREE.Vector3();
        cameraRig.object3D.getWorldDirection(direction);
        direction.y = 0; // 水平方向のみの移動
        direction.normalize();

        // 前後移動
        if (event.detail.y !== 0) {
          const moveVector = direction.clone().multiplyScalar(event.detail.y * moveSpeed);
          cameraRig.object3D.position.add(moveVector);
        }

        // 左右回転
        if (event.detail.x !== 0) {
          const rotation = cameraRig.object3D.rotation;
          rotation.y -= event.detail.x * rotationSpeed;
          cameraRig.object3D.rotation.set(rotation.x, rotation.y, rotation.z);
        }
      }
    });

    // 車の自動移動 (例: 前方へ進む)
    function moveCarAutomatically() {
      const moveSpeed = 0.2; // 車の移動速度

      function updateCarPosition() {
        const carPosition = car.object3D.position;
        carPosition.z += moveSpeed; // Z方向に前進
        requestAnimationFrame(updateCarPosition);
      }

      updateCarPosition();
    }

    // 初期化時に車の自動移動を開始
    document.addEventListener("DOMContentLoaded", moveCarAutomatically);
  </script>
</body>
</html>
