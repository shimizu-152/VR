<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Road for Kids</title>
  <meta name="description" content="Cute VR Road for Kids - A-Frame">
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <div id="start-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); color: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <button style="padding: 20px; font-size: 24px;">Start VR</button>
  </div>

  <a-scene id="scene">
    <!-- Ground (Road) -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="300" height="300" color="#8B8B8B"></a-plane>

    <!-- 車 -->
    <a-entity 
      id="car"
      position="2.978 0 -20.443"  
      scale="1 1 1"         
      rotation="0 0 0"    
      gltf-model="car.glb">
      <!-- クラクションの音 -->
      <a-sound src="car.mp3" autoplay="false" position="0 0 0"></a-sound>
    </a-entity>

    <!-- 家 -->
    <a-entity position="-15.461 2.878 -30" scale="0.4 0.4 0.4" gltf-model="orangehouse.glb"></a-entity>
    <a-entity position="-15.358 3 -17" scale="0.4 0.4 0.4" gltf-model="yellowhouse.glb"></a-entity>
    <a-entity position="-10.983 3 -10" scale="0.4 0.4 0.4" rotation="0 90 0" gltf-model="purplehouse.glb"></a-entity>
    <a-entity position="-10.983 3 13" scale="0.4 0.4 0.4" rotation="0 90 0" gltf-model="bluehouse.glb"></a-entity>

    <!-- 空 -->
    <a-sky color="#87CEEB"></a-sky>

    <!-- カメラとコントロール（歩行者視点） -->
    <a-entity camera position="5 0.5 0" look-controls>
      <a-entity wasd-controls></a-entity>
    </a-entity>
  </a-scene>

  <script>
    // 初回クリックで音声再生を許可
    document.getElementById('start-overlay').addEventListener('click', function () {
      // オーバーレイを非表示にする
      this.style.display = 'none';
      // 車のアニメーション開始
      animate();
    });

    // 車を前進させる関数
    function animate() {
      const car = document.getElementById('car');
      const position = car.getAttribute('position');
      const sound = car.querySelector('a-sound');

      // 車を前進させる（Z軸に沿って移動）
      position.z += 0.5;

      // 新しい位置を設定
      car.setAttribute('position', position);

      // クラクション音を鳴らす条件（車がカメラの近くを通り過ぎるとき）
      if (position.z >= -5 && position.z <= -3 && !sound.components.sound.isPlaying) {
        sound.components.sound.playSound();
      }

      // 一定距離まで進んだら車を見えなくする
      if (position.z > 5) {
        car.setAttribute('visible', false);
      } else {
        // アニメーションループを作成
        requestAnimationFrame(animate);
      }
    }
  </script>
</body>
</html>
